<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Settings Core · sbt Reference Manual</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='website'/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../js/page.js"></script>
<script type="text/javascript" src="../../js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="../../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../../css/page.css"/>

<!--
<link rel="shortcut icon" href="../../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../../index.html" >
<span class="home-icon">⌂</span>sbt Reference Manual
</a>
<div class="version-number">
1.0.2
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../../getting-started/index.html" class="page">Getting Started with sbt</a>
  <ul>
    <li><a href="../../getting-started/setup.html" class="page">Installing sbt</a></li>
    <li><a href="../../getting-started/hello-world.html" class="page">Hello, World</a></li>
    <li><a href="../../getting-started/running.html" class="page">Running sbt</a></li>
  </ul></li>
  <li><a href="../../plugin-developers/index.html" class="page">sbt for Plugin Developers</a>
  <ul>
    <li><a href="../../plugin-developers/anatomy.html" class="page">Anatomy of an sbt Plugin</a></li>
    <li><a href="../../plugin-developers/testing.html" class="page">Testing sbt Plugins</a></li>
    <li><a href="../../plugin-developers/best-practices.html" class="page">Best Practices</a></li>
    <li><a href="../../plugin-developers/cross-building.html" class="page">Cross-building Plugins</a></li>
  </ul></li>
  <li><a href="../../developing-sbt/index.html" class="page">Developing sbt</a>
  <ul>
    <li><a href="../../developing-sbt/modules.html" class="page">Modularization</a></li>
    <li><a href="../../developing-sbt/coding-guidelines.html" class="page">Coding Guidelines</a></li>
    <li><a href="../../developing-sbt/sbt-datatype.html" class="page">sbt-datatype</a></li>
    <li><a href="../../developing-sbt/compiler-interface/index.html" class="page">Compiler Interface</a></li>
    <li><a href="../../developing-sbt/launcher/index.html" class="page">sbt Launcher</a></li>
    <li><a href="../../developing-sbt/developer-notes/index.html" class="page">Developer Notes</a></li>
  </ul></li>
  <li><a href="../../faq.html" class="page">FAQ</a></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../../index.html">sbt Reference Manual</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../../index.html" >
<span class="home-icon">⌂</span>sbt Reference Manual
</a>
<div class="version-number">
1.0.2
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../../getting-started/index.html" class="page">Getting Started with sbt</a>
  <ul>
    <li><a href="../../getting-started/setup.html" class="page">Installing sbt</a></li>
    <li><a href="../../getting-started/hello-world.html" class="page">Hello, World</a></li>
    <li><a href="../../getting-started/running.html" class="page">Running sbt</a></li>
  </ul></li>
  <li><a href="../../plugin-developers/index.html" class="page">sbt for Plugin Developers</a>
  <ul>
    <li><a href="../../plugin-developers/anatomy.html" class="page">Anatomy of an sbt Plugin</a></li>
    <li><a href="../../plugin-developers/testing.html" class="page">Testing sbt Plugins</a></li>
    <li><a href="../../plugin-developers/best-practices.html" class="page">Best Practices</a></li>
    <li><a href="../../plugin-developers/cross-building.html" class="page">Cross-building Plugins</a></li>
  </ul></li>
  <li><a href="../../developing-sbt/index.html" class="page">Developing sbt</a>
  <ul>
    <li><a href="../../developing-sbt/modules.html" class="page">Modularization</a></li>
    <li><a href="../../developing-sbt/coding-guidelines.html" class="page">Coding Guidelines</a></li>
    <li><a href="../../developing-sbt/sbt-datatype.html" class="page">sbt-datatype</a></li>
    <li><a href="../../developing-sbt/compiler-interface/index.html" class="page">Compiler Interface</a></li>
    <li><a href="../../developing-sbt/launcher/index.html" class="page">sbt Launcher</a></li>
    <li><a href="../../developing-sbt/developer-notes/index.html" class="page">Developer Notes</a></li>
  </ul></li>
  <li><a href="../../faq.html" class="page">FAQ</a></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../../index.html">sbt Reference Manual</a></li>
  <li><a href="../../developing-sbt/index.html">Developing sbt</a></li>
  <li><a href="../../developing-sbt/developer-notes/index.html">Developer Notes</a></li>
  <li>Settings Core</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h2><a href="#settings-core" name="settings-core" class="anchor"><span class="anchor-link"></span></a>Settings Core</h2>
<p>This page describes the core settings engine a bit. This may be useful for using it outside of sbt. It may also be useful for understanding how sbt works internally.</p>
<p>The documentation is comprised of two parts. The first part shows an example settings system built on top of the settings engine. The second part comments on how sbt&rsquo;s settings system is built on top of the settings engine. This may help illuminate what exactly the core settings engine provides and what is needed to build something like the sbt settings system.</p>
<h3><a href="#example" name="example" class="anchor"><span class="anchor-link"></span></a>Example</h3>
<h4><a href="#setting-up" name="setting-up" class="anchor"><span class="anchor-link"></span></a>Setting up</h4>
<p>To run this example, first create a new project with the following <code>build.sbt</code> file:</p>
<pre class="prettyprint"><code class="language-scala">libraryDependencies += &quot;org.scala-sbt&quot; %% &quot;collections&quot; % sbtVersion.value

resolvers += sbtResolver.value
</code></pre>
<p>Then, put the following examples in source files <code>SettingsExample.scala</code> and <code>SettingsUsage.scala</code>. Finally, run sbt and enter the REPL using <code>console</code>. To see the output described below, enter <code>SettingsUsage</code>.</p>
<h4><a href="#example-settings-system" name="example-settings-system" class="anchor"><span class="anchor-link"></span></a>Example Settings System</h4>
<p>The first part of the example defines the custom settings system. There are three main parts:</p>
<ol>
  <li>Define the <code>Scope</code> type.</li>
  <li>Define a function that converts that <code>Scope</code> (plus an <code>AttributeKey</code>) to a <code>String</code>.</li>
  <li>Define a delegation function that defines the sequence of <code>Scope</code>s in which to look up a value.</li>
</ol>
<p>There is also a fourth, but its usage is likely to be specific to sbt at this time. The example uses a trivial implementation for this part.</p>
<p><code>SettingsExample.scala</code>:</p>
<pre class="prettyprint"><code class="language-scala">import sbt._

/** Define our settings system */

// A basic scope indexed by an integer.
final case class Scope(index: Int)

// Extend the Init trait.
//  (It is done this way because the Scope type parameter is used everywhere in Init.
//  Lots of type constructors would become binary, which as you may know requires lots of type lambdas
//  when you want a type function with only one parameter.
//  That would be a general pain.)
object SettingsExample extends Init[Scope] {
  // Provides a way of showing a Scope+AttributeKey[_]
  val showFullKey: Show[ScopedKey[_]] = new Show[ScopedKey[_]] {
    def apply(key: ScopedKey[_]) = key.scope.index + &quot;/&quot; + key.key.label
  }

  // A sample delegation function that delegates to a Scope with a lower index.
  val delegates: Scope =&gt; Seq[Scope] = { case s @ Scope(index) =&gt;
    s +: (if(index &lt;= 0) Nil else delegates(Scope(index-1)) )
  }

  // Not using this feature in this example.
  val scopeLocal: ScopeLocal = _ =&gt; Nil

  // These three functions + a scope (here, Scope) are sufficient for defining our settings system.
}
</code></pre>
<h4><a href="#example-usage" name="example-usage" class="anchor"><span class="anchor-link"></span></a>Example Usage</h4>
<p>This part shows how to use the system we just defined. The end result is a <code>Settings[Scope]</code> value. This type is basically a mapping <code>Scope -&gt; AttributeKey[T] -&gt; Option[T]</code>. See the <a href="../api/sbt/Settings.html">Settings API documentation</a> for details.</p>
<p><code>SettingsUsage.scala</code>:</p>
<pre class="prettyprint"><code class="language-scala">/** Usage Example **/

import sbt._
import SettingsExample._
import Types._

object SettingsUsage {
  // Define some keys
  val a = AttributeKey[Int](&quot;a&quot;)
  val b = AttributeKey[Int](&quot;b&quot;)

  // Scope these keys
  val a3 = ScopedKey(Scope(3), a)
  val a4 = ScopedKey(Scope(4), a)
  val a5 = ScopedKey(Scope(5), a)

  val b4 = ScopedKey(Scope(4), b)

  // Define some settings
  val mySettings: Seq[Setting[_]] = Seq(
    setting( a3, value( 3 ) ),
    setting( b4, map(a4)(_ * 3)),
    update(a5)(_ + 1)
  )

  // &quot;compiles&quot; and applies the settings.
  //  This can be split into multiple steps to access intermediate results if desired.
  //  The &#39;inspect&#39; command operates on the output of &#39;compile&#39;, for example.
  val applied: Settings[Scope] = make(mySettings)(delegates, scopeLocal, showFullKey)

  // Show results.
  for(i &lt;- 0 to 5; k &lt;- Seq(a, b)) {
    println( k.label + i + &quot; = &quot; + applied.get( Scope(i), k) )
  }
}
</code></pre>
<p>This produces the following output when run:</p>
<pre><code>a0 = None
b0 = None
a1 = None
b1 = None
a2 = None
b2 = None
a3 = Some(3)
b3 = None
a4 = Some(3)
b4 = Some(9)
a5 = Some(4)
b5 = Some(9)
</code></pre>
<ul>
  <li>For the <code>None</code> results, we never defined the value and there was no value to delegate to.</li>
  <li>For <code>a3</code>, we explicitly defined it to be 3.</li>
  <li><code>a4</code> wasn&rsquo;t defined, so it delegates to <code>a3</code> according to our <code>delegates</code> function.</li>
  <li><code>b4</code> gets the value for <code>a4</code> (which delegates to <code>a3</code>, so it is 3) and multiplies by 3</li>
  <li><code>a5</code> is defined as the previous value of <code>a5</code> + 1 and since no previous value of <code>a5</code> was defined, it delegates to  <code>a4</code>, resulting in 3+1=4.</li>
  <li><code>b5</code> isn&rsquo;t defined explicitly, so it delegates to <code>b4</code> and is therefore equal to 9 as well</li>
</ul>
<h3><a href="#sbt-settings-discussion" name="sbt-settings-discussion" class="anchor"><span class="anchor-link"></span></a>sbt Settings Discussion</h3>
<h4><a href="#scopes" name="scopes" class="anchor"><span class="anchor-link"></span></a>Scopes</h4>
<p>sbt defines a more complicated scope than the one shown here for the standard usage of settings in a build. This scope has four components: the project axis, the configuration axis, the task axis, and the extra axis. Each component may be <a href="../api/sbt/Global\$.html">Global</a> (no specific value), <a href="../api/sbt/This\$.html">This</a> (current context), or <a href="../api/sbt/Select.html">Select</a> (containing a specific value). sbt resolves <code>This_</code> to either <a href="../api/sbt/Global\$.html">Global</a> or <a href="../api/sbt/Select.html">Select</a> depending on the context.</p>
<p>For example, in a project, a <a href="../api/sbt/This\$.html">This</a> project axis becomes a <a href="../api/sbt/Select.html">Select</a> referring to the defining project. All other axes that are <a href="../api/sbt/This\$.html">This</a> are translated to <a href="../api/sbt/Global\$.html">Global</a>. Functions like <code>inConfig</code> and <code>inTask</code> transform <code>This</code> into a <a href="../api/sbt/Select.html">Select</a> for a specific value. For example, <code>inConfig(Compile)(someSettings)</code> translates the configuration axis for all settings in <em>someSettings</em> to be <code>Select(Compile)</code> if the axis value is <a href="../api/sbt/This\$.html">This</a>.</p>
<p>So, from the example and from sbt&rsquo;s scopes, you can see that the core settings engine does not impose much on the structure of a scope. All it requires is a <code>delegates</code> function <code>Scope =&gt; Seq[Scope]</code> and a <code>display</code> function. You can choose a scope type that makes sense for your situation.</p>
<h4><a href="#constructing-settings" name="constructing-settings" class="anchor"><span class="anchor-link"></span></a>Constructing settings</h4>
<p>The <code>app</code>, <code>value</code>, <code>update</code>, and related methods are the core methods for constructing settings. This example obviously looks rather different from sbt&rsquo;s interface because these methods are not typically used directly, but are wrapped in a higher-level abstraction.</p>
<p>With the core settings engine, you work with <code>HList</code>s to access other settings. In sbt&rsquo;s higher-level system, there are wrappers around <code>HList</code> for <code>TupleN</code> and <code>FunctionN</code> for N = 1-9 (except <code>Tuple1</code> isn&rsquo;t actually used). When working with arbitrary arity, it is useful to make these wrappers at the highest level possible. This is because once wrappers are defined, code must be duplicated for every N. By making the wrappers at the top-level, this requires only one level of duplication.</p>
<p>Additionally, sbt uniformly integrates its task engine into the settings system. The underlying settings engine has no notion of tasks. This is why sbt uses a <code>SettingKey</code> type and a <code>TaskKey</code> type. Methods on an underlying <code>TaskKey[T]</code> are basically translated to operating on an underlying <code>SettingKey[Task[T]]</code> (and they both wrap an underlying  <code>AttributeKey</code>).</p>
<p>For example, <code>a := 3</code> for a SettingKey <em>a</em> will very roughly translate to <code>setting(a, value(3))</code>. For a TaskKey <em>a</em>, it will roughly translate to <code>setting(a, value( task { 3 } ) )</code>. See <a href="../sxr/sbt/Structure.scala">main/Structure.scala</a> for details.</p>
<h4><a href="#settings-definitions" name="settings-definitions" class="anchor"><span class="anchor-link"></span></a>Settings definitions</h4>
<p>sbt also provides a way to define these settings in a file (<code>build.sbt</code> and <code>Build.scala</code>). This is done for <code>build.sbt</code> using basic parsing and then passing the resulting chunks of code to <code>compile/Eval.scala</code>. For all definitions, sbt manages the classpaths and recompilation process to obtain the settings. It also provides a way for users to define project, task, and configuration delegation, which ends up being used by the <code>delegates</code> function.</p>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/sbt/website/tree/master/src/paradox/developing-sbt/developer-notes/settings-core.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../../developing-sbt/developer-notes/settings-initialization.html">Setting Initialization</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../../developing-sbt/developer-notes/settings-core.html#settings-core" class="header">Settings Core</a>
  <ul>
    <li><a href="../../developing-sbt/developer-notes/settings-core.html#example" class="header">Example</a></li>
    <li><a href="../../developing-sbt/developer-notes/settings-core.html#sbt-settings-discussion" class="header">sbt Settings Discussion</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2017</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../../js/magellan.js"></script>

<style type="text/css">@import "../../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

</html>
